<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDR Calculator</title>

  <style>
    :root {
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --result:#111827;
    }

    body.dark {
      --bg:#0f172a;
      --card:#111827;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#3b82f6;
      --result:#020617;
    }

    body {
      font-family: Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      margin:0;
      padding:12px 12px 90px 12px;
      display:flex;
      justify-content:center;
      transition:0.2s;
    }

    .app {
      background:var(--card);
      max-width:800px;
      width:100%;
      border-radius:14px;
      padding:16px;
      box-shadow:0 10px 25px rgba(0,0,0,0.15);
      animation:fadeIn .25s ease;
    }

    @keyframes fadeIn {
      from {opacity:0; transform:translateY(6px);} 
      to {opacity:1; transform:translateY(0);} 
    }

    .header {
      position:sticky;
      top:0;
      background:var(--card);
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
      padding-bottom:6px;
    }

    .logo {
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:bold;
      font-size:18px;
    }

    .logoMark {
      width:36px;
      height:36px;
      border-radius:8px;
      background:linear-gradient(135deg,#2563eb,#22c55e);
      display:flex;
      align-items:center;
      justify-content:center;
      color:white;
      font-weight:bold;
    }

    .card {
      border:1px solid rgba(0,0,0,0.08);
      border-radius:12px;
      padding:12px;
      margin-top:12px;
    }

    .themeBtn {
      background:var(--accent);
      color:white;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
    }

    .grid {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }

    label { font-size:13px; color:var(--muted); }

    table { width:100%; border-collapse:collapse; margin:10px 0; }
    th, td { border-bottom:1px solid rgba(0,0,0,0.08); padding:6px; text-align:center; }

    input, select {
      width:100%;
      padding:10px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:16px;
      background:var(--card);
      color:var(--text);
    }

    button {
      padding:12px;
      border:none;
      border-radius:10px;
      cursor:pointer;
      margin-top:8px;
      transition:.15s;
    }

    button:active { transform:scale(0.96); }

    .primary { background:var(--accent); color:white; }
    .danger { background:#dc2626; color:white; }
    .success { background:#16a34a; color:white; }
    .warn { background:#f59e0b; color:white; }

    .result {
      margin-top:12px;
      background:linear-gradient(135deg,#111827,#1f2933);
      color:white;
      padding:18px;
      border-radius:12px;
      font-size:22px;
      text-align:center;
      transition:.2s;
    }

    .flash { animation:flash .35s ease; }

    @keyframes flash {
      0% { transform:scale(1.04); }
      100% { transform:scale(1); }
    }

    .fab {
      position:fixed;
      bottom:16px;
      right:16px;
      width:60px;
      height:60px;
      border-radius:50%;
      background:var(--accent);
      color:white;
      font-size:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 10px 20px rgba(0,0,0,0.25);
      cursor:pointer;
    }

    @media (max-width:640px) {
      .grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>

<div class="app" id="invoice">

  <div class="header">
    <div class="logo">
      <div class="logoMark">P</div>
      PDR PRO
    </div>
    <button class="themeBtn" onclick="toggleTheme()">‚òÄÔ∏è / üåô</button>
  </div>

  <div class="card">
    <h3>üßæ –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞</h3>
    <div class="grid">
      <div>
        <label>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</label>
        <input id="orderNumber" value="001">
      </div>

      <div>
        <label>üìÖ –î–∞—Ç–∞</label>
        <input id="date" type="date">
      </div>

      <div>
        <label>üë§ –ö–ª–∏–µ–Ω—Ç</label>
        <input id="client">
      </div>

      <div>
        <label>üöó –ê–≤—Ç–æ–º–æ–±–∏–ª—å</label>
        <input id="car">
      </div>
    </div>
  </div>

  <div class="card">
    <h3>üîß –í–º—è—Ç–∏–Ω—ã</h3>
    <table id="dentTable">
      <thead>
        <tr>
          <th>–†–∞–∑–º–µ—Ä</th>
          <th>–ó–æ–Ω–∞</th>
          <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
          <th>–¶–µ–Ω–∞</th>
          <th></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button class="primary" onclick="addDent()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–º—è—Ç–∏–Ω—É</button>
  </div>

  <div class="card">
    <h3>üßÆ –†–∞—Å—á—ë—Ç</h3>

    <label>üîß –ß–∞—Å—ã</label>
    <input id="hours" type="number" value="1">

    <label>üí∞ –°—Ç–∞–≤–∫–∞</label>
    <input id="rate" type="number" value="10000">

    <label>üß∞ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã</label>
    <input id="materials" type="number" value="2000">

    <label>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</label>
    <input id="minPrice" type="number" value="5000">

    <label>–°–∫–∏–¥–∫–∞ (%)</label>
    <input id="discount" type="number" value="0">

    <div class="card" style="margin-top:12px;">
      <div>–†–∞–±–æ—Ç—ã: <b id="laborSum">0 ‚Ç∏</b></div>
      <div>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã: <b id="materialsSum">0 ‚Ç∏</b></div>
      <div>–í–º—è—Ç–∏–Ω—ã: <b id="dentsSum">0 ‚Ç∏</b></div>
      <hr>
      <div class="result" id="total">–ò—Ç–æ–≥–æ: 0 ‚Ç∏</div>
    </div>

    <button class="warn" onclick="exportPDF()">PDF</button>
    <button class="success" onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<div class="fab" onclick="addDent();vibrate();">+</div>

<script>
const zoneK={"–¥–≤–µ—Ä—å":1,"–∫—Ä—ã–ª–æ":1.2,"–∫–∞–ø–æ—Ç":1.3,"–∫—Ä—ã—à–∞":1.5};
const diffK={"–ª–µ–≥–∫–∞—è":1,"—Å—Ä–µ–¥–Ω—è—è":1.5,"—Å–ª–æ–∂–Ω–∞—è":2};

function vibrate(){ if(navigator.vibrate) navigator.vibrate(30); }

function toggleTheme(){
 document.body.classList.toggle("dark");
 localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
}

(function(){
 if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");
 document.getElementById("date").valueAsDate=new Date();
})();

function addDent(size=5){
 const tr=document.createElement("tr");
 tr.innerHTML=`
 <td><input class="size" type="number" value="${size}"></td>
 <td><select class="zone"><option>–¥–≤–µ—Ä—å</option><option>–∫—Ä—ã–ª–æ</option><option>–∫–∞–ø–æ—Ç</option><option>–∫—Ä—ã—à–∞</option></select></td>
 <td><select class="diff"><option>–ª–µ–≥–∫–∞—è</option><option>—Å—Ä–µ–¥–Ω—è—è</option><option>—Å–ª–æ–∂–Ω–∞—è</option></select></td>
 <td class="price">0</td>
 <td><button class="danger" onclick="removeDent(this)">‚úï</button></td>`;

 document.querySelector("#dentTable tbody").appendChild(tr);
 tr.querySelectorAll("input,select").forEach(el=>el.addEventListener("input",calc));
 calc();
}

function removeDent(btn){ btn.closest("tr").remove(); calc(); vibrate(); }

function calc(){
 let dentsTotal=0;
 const minPrice=+minPriceInput.value;

 document.querySelectorAll("#dentTable tbody tr").forEach(row=>{
  let p=+row.querySelector(".size").value*500;
  p*=zoneK[row.querySelector(".zone").value];
  p*=diffK[row.querySelector(".diff").value];
  p=Math.max(p,minPrice);
  row.querySelector(".price").innerText=Math.round(p);
  dentsTotal+=p;
 });

 if(document.querySelectorAll("#dentTable tbody tr").length>1)
  dentsTotal*=1-(+discountInput.value/100);

 const labor=+hoursInput.value*+rateInput.value;
 const materialsCost=+materialsInput.value;
 const total=dentsTotal+labor+materialsCost;

 laborSum.innerText=Math.round(labor)+" ‚Ç∏";
 materialsSum.innerText=Math.round(materialsCost)+" ‚Ç∏";
 dentsSum.innerText=Math.round(dentsTotal)+" ‚Ç∏";

 totalDiv.innerText="–ò—Ç–æ–≥–æ: "+Math.round(total)+" ‚Ç∏";
 totalDiv.classList.add("flash");
 setTimeout(()=>totalDiv.classList.remove("flash"),200);
}

function saveData(){ alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ"); }
function exportPDF(){ window.print(); }

const minPriceInput=document.getElementById("minPrice");
const discountInput=document.getElementById("discount");
const hoursInput=document.getElementById("hours");
const rateInput=document.getElementById("rate");
const materialsInput=document.getElementById("materials");
const totalDiv=document.getElementById("total");
const laborSum=document.getElementById("laborSum");
const materialsSum=document.getElementById("materialsSum");
const dentsSum=document.getElementById("dentsSum");

[minPriceInput,discountInput,hoursInput,rateInput,materialsInput]
.forEach(el=>el.addEventListener("input",calc));

addDent();
</script>

</body>
</html>
